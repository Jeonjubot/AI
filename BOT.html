<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>KT MOS ÎÇ®Î∂Ä</title>
  <style>
    body {
      font-family: 'Apple SD Gothic Neo', sans-serif;
      background-color: #c7dbe6;
      margin: 0;
      padding: 0;
      font-size: 17px;
    }
    .chat-container {
      width: 100%;
      max-width: 504px;
      margin: 0 auto;
      height: 100dvh;
      display: flex;
      flex-direction: column;
    }
    .chat-box {
      flex: 1;
      overflow-y: auto;
      padding: 12px;
    }
    .message {
      display: flex;
      margin: 12px 0;
      align-items: flex-start;
    }
    .message.bot {
      justify-content: flex-start;
    }
    .message.user {
      justify-content: flex-end;
    }
    .bubble {
      max-width: 100%;
      padding: 12px 17px;
      border-radius: 24px;
      font-size: 17px;
      line-height: 1.5;
      white-space: pre-line;
      background-color: #ffffff;
      color: #000;
    }
    .bot .bubble { border-top-left-radius: 0; }
    .user .bubble { border-top-right-radius: 0; }
    .avatar {
      width: 46px;
      height: 46px;
      border-radius: 50%;
      margin-right: 10px;
    }
    .name {
      font-size: 14px;
      color: #444;
      margin-bottom: 3px;
      margin-left: 5px;
    }
    .input-area {
      padding: 12px;
      border-top: 1px solid #ddd;
      display: flex;
      background: #fff;
    }
    .input-area input {
      flex: 1;
      padding: 12px;
      font-size: 17px;
      border: 1px solid #ccc;
      border-radius: 24px;
      outline: none;
    }
    .input-area button {
      margin-left: 12px;
      padding: 0 21px;
      border: none;
      background-color: #007AFF;
      color: white;
      font-weight: bold;
      border-radius: 24px;
      cursor: pointer;
      font-size: 17px;
    }
  </style>
</head>
<body>
  <div class="chat-container">
    <div class="chat-box" id="chatWindow"></div>
    <div class="input-area">
      <input id="input" type="text" placeholder="Î≤àÌò∏ ÏûÖÎ†•..." />
      <button onclick="handleSend()">Ï†ÑÏÜ°</button>
    </div>
  </div>

<script>
  let chatData = [], currentNode = null, codeInputPhase = true, currentCode = "", previousHeight = window.innerHeight;

  function showMessage(text, isUser = false) {
    const chat = document.getElementById("chatWindow");
    const msgWrapper = document.createElement("div");
    msgWrapper.className = "message " + (isUser ? "user" : "bot");

    if (!isUser) {
      const avatar = document.createElement("img");
      avatar.className = "avatar";
      avatar.src = "./Ïù¥ÎØ∏ÏßÄ/profile.png";

      const content = document.createElement("div");
      const name = document.createElement("div");
      name.className = "name";
      name.textContent = "KT MOS ÎÇ®Î∂Ä";

      const bubble = document.createElement("div");
      bubble.className = "bubble";
      bubble.innerHTML = text.replace(/\n/g, "<br>");

      content.appendChild(name);
      content.appendChild(bubble);
      msgWrapper.appendChild(avatar);
      msgWrapper.appendChild(content);
    } else {
      const bubble = document.createElement("div");
      bubble.className = "bubble";
      bubble.innerHTML = text.replace(/\n/g, "<br>");
      msgWrapper.appendChild(bubble);
    }

    chat.appendChild(msgWrapper);
    chat.scrollTop = chat.scrollHeight;
  }

  async function showImageFirst(imageName, text = "") {
    const imagePath = `./Ïù¥ÎØ∏ÏßÄ/${currentCode}/${imageName}.png`;
    try {
      const res = await fetch(imagePath);
      if (res.ok) {
        const combined = text
          ? `<img src="${imagePath}" style="max-width:100%; border-radius:12px;"><br>${text}`
          : `<img src="${imagePath}" style="max-width:100%; border-radius:12px;">`;
        showMessage(combined);
        return true;
      }
    } catch {}
    return false;
  }

  async function showQuestion(id) {
    currentNode = chatData.find(d => d.ID === id);
    if (!currentNode) return;

    if (currentNode.Ïù¥ÎØ∏ÏßÄ) {
      const shown = await showImageFirst(currentNode.Ïù¥ÎØ∏ÏßÄ, currentNode.ÏßàÎ¨∏ÎÇ¥Ïö©);
      if (!shown) showMessage(currentNode.ÏßàÎ¨∏ÎÇ¥Ïö©);
    } else {
      showMessage(currentNode.ÏßàÎ¨∏ÎÇ¥Ïö©);
    }

    if (currentNode.ÏÑ†ÌÉùÏßÄ && currentNode.ÏÑ†ÌÉùÏßÄ.length > 0) {
      const optionsText = currentNode.ÏÑ†ÌÉùÏßÄ.map(opt => `${opt.Î≤àÌò∏}. ${opt.ÎÇ¥Ïö©}`).join("\n");
      showMessage(optionsText);
    }
  }

  async function handleSend() {
    const input = document.getElementById("input");
    const val = input.value.trim();
    if (!val) return;

    showMessage(val, true);
    input.value = "";

    if (codeInputPhase) {
      currentCode = val;
      try {
        const res = await fetch(`./ÏΩîÎìú/${currentCode}.json`);
        if (!res.ok) throw new Error("Not found");
        chatData = await res.json();
        codeInputPhase = false;
        showQuestion("Q1");
      } catch {
        showMessage("‚ùå Ï°¥Ïû¨ÌïòÏßÄ ÏïäÎäî ÏΩîÎìúÏûÖÎãàÎã§. Îã§Ïãú ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.");
      }
      return;
    }

    const number = parseInt(val, 10);
    const isImageTarget = isNaN(number) || number > 20;
    let imageShown = false;

    if (isImageTarget) {
      const imagePath = `./Ïù¥ÎØ∏ÏßÄ/${currentCode}/${val}.png`;
      try {
        const res = await fetch(imagePath);
        if (res.ok) {
          const imgTag = `<img src="${imagePath}" style="max-width:100%; border-radius:12px;">`;
          showMessage(imgTag);
          imageShown = true;
        }
      } catch {}
    }

    if (!currentNode) return;

    const next = currentNode.ÏÑ†ÌÉùÏßÄ.find(opt => opt.Î≤àÌò∏ === val);
    if (next) {
      if (next.Ïù¥ÎØ∏ÏßÄ) {
        const shown = await showImageFirst(next.Ïù¥ÎØ∏ÏßÄ, next.ÎÇ¥Ïö©);
        if (!shown) showMessage(next.ÎÇ¥Ïö©);
      } else {
        showMessage(next.ÎÇ¥Ïö©);
      }

      if (next.Îã§ÏùåID === "END") {
        showMessage("Í∞êÏÇ¨Ìï©ÎãàÎã§!");
      } else {
        showQuestion(next.Îã§ÏùåID);
      }
    } else if (!imageShown) {
      showMessage("Ïò¨Î∞îÎ•∏ Î≤àÌò∏Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.");
    }
  }

  document.getElementById("input").addEventListener("keydown", e => {
    if (e.key === "Enter") handleSend();
  });

  showMessage("üèò ÏßÄÏó≠ÏΩîÎìúÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî.\n(ÏûÑÏãúÏΩîÎìú: 000000)\n\nüñº Ïù¥ÎØ∏ÏßÄ ÎãµÎ≥Ä Í∏∞Îä•\nÏòà) Î¥á, Î™ÖÌï®, Ï†ÑÏ£º\n(ÏßÄÏó≠ÏΩîÎìú ÏûÖÎ†• ÌõÑ ÏÇ¨Ïö© Í∞ÄÎä•)\n\nüíª Developer\nÌò∏ÎÇ®Î≥∏Î∂Ä ÏóÖÎ¨¥Ìö®Ïú®ÌôîTF\n‚úèÔ∏è Planner\nÏ†ÑÏ£ºÏö¥Ïö©ÌåÄ Ïò§Ïö©Ïàò");

  window.addEventListener("resize", () => {
    const currentHeight = window.innerHeight;
    const chat = document.getElementById("chatWindow");
    if (currentHeight < previousHeight) {
      chat.scrollTop = chat.scrollHeight;
    }
    previousHeight = currentHeight;
  });
</script>
</body>
</html>
